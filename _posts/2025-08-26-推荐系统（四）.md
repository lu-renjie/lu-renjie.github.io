---
title: 【推荐系统】架构
tags: 推荐系统 深度学习 笔记
published: false
---


## 特征服务

由于embedding的稀疏性，会采取列存数据库。

### 什么是稀疏特征？

推荐系统会使用大量的特征，比如每个用户有个embedding特征，每个item也有个embedding特征。这样的特征有很多亿个，但是对于一次推荐，只会用到很少一部分，这就是稀疏性。数学上来说，这些特征可以用one-hot表示，其中大多数都是0，所以说是稀疏的。

### FID

字节内部的推荐系统把每一类离散特征赋予一个ID，叫slot_id，比如性别特征、ID特征。每个slot有不同的取值，而且不同的slot可能有不同的数据类型（int、float、string等），为了统一管理，把它们全部计算哈希。于是任意一个特征可以用slot_id+哈希值表示，这个记为FID，一个FID对应一个离散特征（比如“男性”，比如uid为1234）。通过统一的FID表示，推荐系统里不同的服务程序就方便统一管理了，模型里也可以直接用FID索引embedding。

虽然哈希可能存在哈希冲突，但是冲突概率较低，并且embedding本身也有能力表示多个语义，因此整体上认为不影响模型performance。

考虑到不同的模型可能会采取不同的embedding长度，不同的slot的embedding长度也可能不同，字节抽象出了FeatureColumn的概念，一个FeatureColumn就是一个离散特征（由slot_id标识）的embedding table。当给定一个FID需要获取对应的embedding时，会找到对应的FeatureColumn，然后根据哈希值访问里面的embedding。

如果想要简化推荐系统，可以把连续特征也转化为离散特征，统一管理。

依旧觉得特征的值被抹去了，只有一个FID很神奇。。。

## 压力测试

特征怎么测试？特征测试的目的是什么？

- 是否core dump
- 特征覆盖率
- CPU压力

